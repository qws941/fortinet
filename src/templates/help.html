{% extends "base.html" %}

{% block title %}도움말 - FortiGate 방화벽 경로 분석기{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-question-circle me-2"></i>FortiGate 방화벽 경로 분석기 도움말</h4>
            </div>
            <div class="card-body">
                <nav>
                    <div class="nav nav-tabs mb-4" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="nav-overview-tab" data-bs-toggle="tab" data-bs-target="#nav-overview" 
                                type="button" role="tab" aria-controls="nav-overview" aria-selected="true">
                            <i class="fas fa-home me-1"></i>개요
                        </button>
                        <button class="nav-link" id="nav-usage-tab" data-bs-toggle="tab" data-bs-target="#nav-usage" 
                                type="button" role="tab" aria-controls="nav-usage" aria-selected="false">
                            <i class="fas fa-user-cog me-1"></i>사용 방법
                        </button>
                        <button class="nav-link" id="nav-batch-tab" data-bs-toggle="tab" data-bs-target="#nav-batch" 
                                type="button" role="tab" aria-controls="nav-batch" aria-selected="false">
                            <i class="fas fa-tasks me-1"></i>일괄 분석
                        </button>
                        <button class="nav-link" id="nav-api-tab" data-bs-toggle="tab" data-bs-target="#nav-api" 
                                type="button" role="tab" aria-controls="nav-api" aria-selected="false">
                            <i class="fas fa-plug me-1"></i>API 설정
                        </button>
                        <button class="nav-link" id="nav-faq-tab" data-bs-toggle="tab" data-bs-target="#nav-faq" 
                                type="button" role="tab" aria-controls="nav-faq" aria-selected="false">
                            <i class="fas fa-question me-1"></i>FAQ
                        </button>
                    </div>
                </nav>
                
                <div class="tab-content" id="nav-tabContent">
                    <!-- 개요 탭 -->
                    <div class="tab-pane fade show active" id="nav-overview" role="tabpanel" aria-labelledby="nav-overview-tab">
                        <h4>FortiGate 방화벽 경로 분석기란?</h4>
                        <p>
                            FortiGate 방화벽 경로 분석기는 복잡한 네트워크 환경에서 트래픽이 어떤 경로로 흐르고, 
                            각 방화벽에서 어떤 정책이 적용되는지 분석하여 시각화하는 도구입니다.
                        </p>
                        <p>
                            여러 개의 FortiGate 방화벽이 구성된 환경에서 특정 트래픽(출발지 IP에서 목적지 IP로의 특정 포트 통신)이 
                            어떤 방화벽을 거쳐 전달되는지, 각 방화벽에서 어떤 규칙이 적용되는지, 최종적으로 허용되는지 
                            차단되는지를 분석합니다.
                        </p>
                        
                        <div class="card bg-light my-4">
                            <div class="card-body">
                                <h5><i class="fas fa-lightbulb me-2"></i>주요 기능</h5>
                                <ul class="mb-0">
                                    <li>출발지 IP에서 목적지 IP로의 통신 경로 추적</li>
                                    <li>각 방화벽에서 적용되는 정책 규칙의 상세 정보 표시</li>
                                    <li>트래픽 경로의 시각적 다이어그램 제공</li>
                                    <li>차단된 트래픽의 정확한 차단 지점 및 규칙 식별</li>
                                    <li>여러 트래픽 경로를 CSV 파일로 일괄 분석</li>
                                    <li>직관적인 웹 인터페이스와 다크 모드 지원</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h5>사용 환경 요구사항</h5>
                        <ul>
                            <li>
                                <strong>API 연결:</strong> FortiGate 장비 직접 연결 또는 FortiManager를 통한 연결
                            </li>
                            <li>
                                <strong>API 토큰:</strong> FortiGate 또는 FortiManager API 토큰 (권장) 또는 관리자 계정
                            </li>
                            <li>
                                <strong>웹 브라우저:</strong> 최신 버전의 Chrome, Firefox, Edge, Safari
                            </li>
                        </ul>
                        
                        <h5>시작하기</h5>
                        <ol>
                            <li>
                                <a href="{{ url_for('main.settings') }}" class="text-decoration-none">설정 페이지</a>에서 
                                FortiGate 또는 FortiManager API 연결 정보 구성
                            </li>
                            <li>
                                <a href="{{ url_for('main.index') }}" class="text-decoration-none">메인 페이지</a>에서 
                                분석할 트래픽의 출발지/목적지 IP, 포트, 프로토콜 입력
                            </li>
                            <li>
                                분석 결과에서 트래픽 경로 및 방화벽 정책 정보 확인
                            </li>
                        </ol>
                    </div>
                    
                    <!-- 사용 방법 탭 -->
                    <div class="tab-pane fade" id="nav-usage" role="tabpanel" aria-labelledby="nav-usage-tab">
                        <h4>기본 사용법</h4>
                        
                        <h5 class="mt-4">1. 단일 트래픽 경로 분석</h5>
                        <ol>
                            <li>
                                <strong>메인 페이지 접속:</strong> 
                                <a href="{{ url_for('main.index') }}" class="text-decoration-none">홈 화면</a>에 접속합니다.
                            </li>
                            <li>
                                <strong>트래픽 정보 입력:</strong>
                                <ul>
                                    <li><strong>출발지 IP/네트워크:</strong> 트래픽의 시작점 IP 주소 (예: {{ example_src_ip }})</li>
                                    <li><strong>목적지 IP/네트워크:</strong> 트래픽의 도착점 IP 주소 (예: {{ example_dst_ip }})</li>
                                    <li><strong>포트 번호:</strong> 통신에 사용되는 포트 번호 (예: 443)</li>
                                    <li><strong>프로토콜:</strong> 사용 프로토콜 선택 (TCP, UDP, ICMP)</li>
                                </ul>
                            </li>
                            <li>
                                <strong>분석 시작:</strong> "경로 분석 시작" 버튼을 클릭합니다.
                            </li>
                            <li>
                                <strong>결과 확인:</strong> 분석이 완료되면 결과 페이지가 표시됩니다.
                                <ul>
                                    <li><strong>요약 정보:</strong> 트래픽 허용/차단 여부 및 기본 정보</li>
                                    <li><strong>패킷 경로 표:</strong> 각 홉(방화벽)에서의 처리 정보</li>
                                    <li><strong>방화벽 규칙 상세:</strong> 적용된 방화벽 정책의 상세 내용</li>
                                </ul>
                            </li>
                            <li>
                                <strong>네트워크 맵 확인:</strong> "전체 네트워크 맵 보기" 버튼을 클릭하여 시각화된 경로를 확인합니다.
                            </li>
                        </ol>
                        
                        <h5 class="mt-4">2. 네트워크 맵 활용</h5>
                        <p>
                            네트워크 맵 페이지에서는 트래픽 경로를 시각적으로 확인할 수 있습니다:
                        </p>
                        <ul>
                            <li>
                                <strong>노드 정보:</strong> 호스트(출발지, 목적지) 또는 방화벽 노드를 클릭하여 상세 정보 확인
                            </li>
                            <li>
                                <strong>연결 정보:</strong> 노드 간 연결선을 클릭하여 해당 구간의 정책 정보 확인
                            </li>
                            <li>
                                <strong>레이아웃 변경:</strong> 다양한 레이아웃 옵션으로 맵 배치 변경
                            </li>
                            <li>
                                <strong>확대/축소:</strong> 맵을 확대하거나 축소하여 상세히 보기
                            </li>
                        </ul>
                        
                        <h5 class="mt-4">3. 결과 해석</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">허용된 트래픽</h6>
                                    </div>
                                    <div class="card-body">
                                        <p>
                                            트래픽이 <strong>허용</strong>된 경우 다음 정보가 표시됩니다:
                                        </p>
                                        <ul class="mb-0">
                                            <li>트래픽이 통과한 모든 방화벽 목록</li>
                                            <li>각 방화벽에서 적용된 정책 규칙</li>
                                            <li>녹색으로 표시된 전체 경로</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-header bg-danger text-white">
                                        <h6 class="mb-0">차단된 트래픽</h6>
                                    </div>
                                    <div class="card-body">
                                        <p>
                                            트래픽이 <strong>차단</strong>된 경우 다음 정보가 표시됩니다:
                                        </p>
                                        <ul class="mb-0">
                                            <li>차단이 발생한 정확한 방화벽</li>
                                            <li>차단을 유발한 정책 규칙 번호</li>
                                            <li>빨간색으로 표시된 차단 지점</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 일괄 분석 탭 -->
                    <div class="tab-pane fade" id="nav-batch" role="tabpanel" aria-labelledby="nav-batch-tab">
                        <h4>일괄 분석 기능</h4>
                        <p>
                            여러 트래픽 경로를 한 번에 분석해야 할 경우, CSV 파일을 사용하여 일괄 분석을 수행할 수 있습니다.
                        </p>
                        
                        <h5 class="mt-4">CSV 파일 형식</h5>
                        <p>CSV 파일은 다음 열을 포함해야 합니다:</p>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>출발지IP</th>
                                        <th>목적지IP</th>
                                        <th>포트</th>
                                        <th>프로토콜</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for example in batch_examples %}
                                    <tr>
                                        <td>{{ example.src_ip }}</td>
                                        <td>{{ example.dst_ip }}</td>
                                        <td>{{ example.port }}</td>
                                        <td>{{ example.protocol }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-download me-2"></i>
                            <a href="{{ url_for('static', filename='samples/batch_sample.csv') }}" class="alert-link">
                                샘플 CSV 파일 다운로드
                            </a>
                        </div>
                        
                        <h5 class="mt-4">일괄 분석 단계</h5>
                        <ol>
                            <li>
                                <a href="{{ url_for('main.batch') }}" class="text-decoration-none">일괄 분석 페이지</a>로 이동합니다.
                            </li>
                            <li>
                                위 형식에 맞는 CSV 파일을 준비하고 업로드합니다.
                            </li>
                            <li>
                                "일괄 분석 시작" 버튼을 클릭하여 분석을 시작합니다.
                            </li>
                            <li>
                                분석이 완료되면 모든 경로의 결과가 표 형태로 표시됩니다.
                            </li>
                            <li>
                                각 결과의 "상세보기" 버튼을 클릭하여 개별 경로의 상세 정보를 확인할 수 있습니다.
                            </li>
                        </ol>
                        
                        <h5 class="mt-4">제한 사항</h5>
                        <ul>
                            <li>
                                최대 100개의 트래픽 경로를 일괄 분석할 수 있습니다.
                            </li>
                            <li>
                                CSV 파일은 반드시 헤더 행을 포함해야 합니다.
                            </li>
                            <li>
                                포트는 1-65535 범위의 숫자여야 합니다. ICMP의 경우 0을 입력하세요.
                            </li>
                            <li>
                                프로토콜은 tcp, udp, icmp 중 하나여야 합니다.
                            </li>
                        </ul>
                    </div>
                    
                    <!-- API 설정 탭 -->
                    <div class="tab-pane fade" id="nav-api" role="tabpanel" aria-labelledby="nav-api-tab">
                        <h4>API 연결 설정</h4>
                        <p>
                            FortiGate 방화벽 경로 분석기는 FortiGate 장비 직접 연결 또는 FortiManager를 통한 연결을 지원합니다.
                        </p>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>FortiGate 직접 연결</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>단일 FortiGate 장비에 직접 연결하여 해당 장비의 정책만 분석합니다.</p>
                                        
                                        <h6 class="mt-3">필요 정보:</h6>
                                        <ul>
                                            <li>
                                                <strong>FortiGate 호스트 주소:</strong><br>
                                                FortiGate 장비의 IP 주소 또는 호스트 이름
                                            </li>
                                            <li>
                                                <strong>FortiGate API 토큰:</strong><br>
                                                FortiGate 관리 페이지에서 생성한 REST API 액세스 토큰
                                            </li>
                                        </ul>
                                        
                                        <h6 class="mt-3">API 토큰 생성 방법:</h6>
                                        <ol>
                                            <li>FortiGate 관리 인터페이스에 로그인</li>
                                            <li>시스템 > 관리자 > API 키 관리 메뉴로 이동</li>
                                            <li>"새 API 키 생성"을 클릭하여 토큰 생성</li>
                                            <li>생성된 토큰을 복사하여 설정 페이지에 입력</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0"><i class="fas fa-server me-2"></i>FortiManager 연결</h5>
                                    </div>
                                    <div class="card-body">
                                        <p>FortiManager를 통해 여러 FortiGate 장비를 관리하고 분석합니다.</p>
                                        
                                        <h6 class="mt-3">필요 정보:</h6>
                                        <ul>
                                            <li>
                                                <strong>FortiManager 호스트 주소:</strong><br>
                                                FortiManager 서버의 IP 주소 또는 호스트 이름
                                            </li>
                                            <li>
                                                <strong>FortiManager API 토큰 (권장):</strong><br>
                                                FortiManager API 액세스 토큰
                                            </li>
                                            <li>
                                                <strong>또는 사용자 이름/비밀번호:</strong><br>
                                                FortiManager 관리자 계정 정보
                                            </li>
                                        </ul>
                                        
                                        <h6 class="mt-3">API 토큰 생성 방법:</h6>
                                        <ol>
                                            <li>FortiManager 관리 인터페이스에 로그인</li>
                                            <li>시스템 설정 > 관리자 > API 사용자 메뉴로 이동</li>
                                            <li>"새 API 사용자 생성"을 클릭하여 토큰 생성</li>
                                            <li>생성된 토큰을 복사하여 설정 페이지에 입력</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h5 class="mt-3">연결 설정 및 테스트</h5>
                        <ol>
                            <li><a href="{{ url_for('main.settings') }}" class="text-decoration-none">설정 페이지</a>로 이동합니다.</li>
                            <li>FortiGate 직접 연결 또는 FortiManager 연결 중 하나를 선택합니다.</li>
                            <li>필요한 호스트 정보와 API 토큰(또는 사용자 인증 정보)을 입력합니다.</li>
                            <li>"연결 테스트" 버튼을 클릭하여 설정이 올바른지 확인합니다.</li>
                            <li>연결 테스트가 성공하면 "설정 저장" 버튼을 클릭하여 설정을 저장합니다.</li>
                        </ol>
                        
                        <div class="alert alert-warning mt-4">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>중요:</strong> API 토큰은 보안을 위해 안전하게 보관됩니다. 
                            SSL 인증서 검증이 문제를 일으키는 경우(예: 자체 서명 인증서 사용) 설정 페이지에서 
                            "SSL 인증서 검증" 옵션을 비활성화할 수 있습니다.
                        </div>
                    </div>
                    
                    <!-- FAQ 탭 -->
                    <div class="tab-pane fade" id="nav-faq" role="tabpanel" aria-labelledby="nav-faq-tab">
                        <h4>자주 묻는 질문 (FAQ)</h4>
                        
                        <div class="accordion mt-4" id="faqAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="faq-heading-1">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq-collapse-1" aria-expanded="true" aria-controls="faq-collapse-1">
                                        FortiGate 방화벽 경로 분석기의 정확도는 어떻게 되나요?
                                    </button>
                                </h2>
                                <div id="faq-collapse-1" class="accordion-collapse collapse show" 
                                     aria-labelledby="faq-heading-1" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        <p>
                                            FortiGate 방화벽 경로 분석기는 FortiGate API를 통해 직접 방화벽 정책 및 라우팅 테이블을 
                                            조회하므로 높은 정확도를 제공합니다. 하지만 다음 사항에 유의하세요:
                                        </p>
                                        <ul class="mb-0">
                                            <li>
                                                실제 트래픽이 아닌 설정 기반 분석이므로 동적 상태나 실시간 부하 상태는 고려하지 않습니다.
                                            </li>
                                            <li>
                                                복잡한 VPN, NAT 구성, 또는 비표준 네트워크 토폴로지의 경우 일부 경로 추적에 제한이 있을 수 있습니다.
                                            </li>
                                            <li>
                                                방화벽 외부의 네트워크 장비(스위치, 라우터 등)의 정책은 분석되지 않습니다.
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="faq-heading-2">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq-collapse-2" aria-expanded="false" aria-controls="faq-collapse-2">
                                        여러 대의 방화벽을 분석할 수 있나요?
                                    </button>
                                </h2>
                                <div id="faq-collapse-2" class="accordion-collapse collapse" 
                                     aria-labelledby="faq-heading-2" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        <p>
                                            네, 두 가지 방법으로 여러 대의 방화벽을 분석할 수 있습니다:
                                        </p>
                                        <ol class="mb-0">
                                            <li>
                                                <strong>FortiManager 연결:</strong> FortiManager를 통해 관리되는 모든 FortiGate 장비의 
                                                정책을 한 번에 분석할 수 있습니다. 이 방법이 가장 권장됩니다.
                                            </li>
                                            <li>
                                                <strong>개별 분석 후 통합:</strong> 각 방화벽을 개별적으로 분석한 후, 
                                                라우팅 패턴과 네트워크 토폴로지를 고려하여 결과를 수동으로 연결할 수 있습니다.
                                            </li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="faq-heading-3">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq-collapse-3" aria-expanded="false" aria-controls="faq-collapse-3">
                                        API 토큰 대신 사용자 이름/비밀번호를 사용할 수 있나요?
                                    </button>
                                </h2>
                                <div id="faq-collapse-3" class="accordion-collapse collapse" 
                                     aria-labelledby="faq-heading-3" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        <p>
                                            FortiManager 연결의 경우 API 토큰 또는 사용자 이름/비밀번호 인증 모두 지원합니다. 
                                            하지만 보안상의 이유로 API 토큰 사용을 강력히 권장합니다.
                                        </p>
                                        <p class="mb-0">
                                            FortiGate 직접 연결의 경우 현재 API 토큰만 지원하고 있습니다.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="faq-heading-4">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq-collapse-4" aria-expanded="false" aria-controls="faq-collapse-4">
                                        분석 결과를 저장하거나 내보낼 수 있나요?
                                    </button>
                                </h2>
                                <div id="faq-collapse-4" class="accordion-collapse collapse" 
                                     aria-labelledby="faq-heading-4" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        <p>
                                            현재는 다음과 같은 방법으로 결과를 저장할 수 있습니다:
                                        </p>
                                        <ul class="mb-0">
                                            <li>
                                                <strong>인쇄/PDF 저장:</strong> 결과 페이지 하단의 "결과 인쇄" 버튼을 클릭하여 
                                                프린터로 출력하거나 PDF로 저장할 수 있습니다.
                                            </li>
                                            <li>
                                                <strong>화면 캡처:</strong> 브라우저의 화면 캡처 기능이나 스크린샷 도구를 사용하여 
                                                결과를 이미지로 저장할 수 있습니다.
                                            </li>
                                            <li>
                                                <strong>표 복사:</strong> 데이터 테이블의 내용을 선택하여 복사한 후 
                                                스프레드시트나 문서에 붙여넣을 수 있습니다.
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="faq-heading-5">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#faq-collapse-5" aria-expanded="false" aria-controls="faq-collapse-5">
                                        연결 테스트에 성공했는데 분석이 안 되는 경우는 어떻게 해야 하나요?
                                    </button>
                                </h2>
                                <div id="faq-collapse-5" class="accordion-collapse collapse" 
                                     aria-labelledby="faq-heading-5" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        <p>
                                            연결 테스트는 API 기본 연결만 확인하며, 다음과 같은 문제가 발생할 수 있습니다:
                                        </p>
                                        <ol class="mb-0">
                                            <li>
                                                <strong>권한 문제:</strong> API 토큰이나 사용자 계정에 정책 및 라우팅 정보를 읽을 
                                                권한이 없을 수 있습니다. 관리자 권한 또는 적절한 API 권한을 가진 계정을 사용하세요.
                                            </li>
                                            <li>
                                                <strong>잘못된 입력 데이터:</strong> 분석 중인 IP 주소나 포트가 올바른 형식인지 확인하세요.
                                            </li>
                                            <li>
                                                <strong>네트워크 토폴로지 제한:</strong> 복잡한 네트워크 구성에서는 경로 추적에 
                                                제한이 있을 수 있습니다.
                                            </li>
                                            <li>
                                                <strong>방화벽 제한:</strong> 너무 많은 API 요청을 보내면 방화벽에서 일시적으로 
                                                요청을 차단할 수 있습니다.
                                            </li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}