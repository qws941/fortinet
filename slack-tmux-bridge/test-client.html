<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tmux WebSocket Test Client</title>
  <style>
    body {
      font-family: 'Monaco', 'Menlo', monospace;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #1e1e2e;
      color: #cdd6f4;
    }
    h1 {
      color: #89b4fa;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .panel {
      background: #181825;
      border: 1px solid #45475a;
      border-radius: 8px;
      padding: 15px;
    }
    button {
      background: #89b4fa;
      color: #1e1e2e;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: #a6e3a1;
    }
    button:disabled {
      background: #45475a;
      cursor: not-allowed;
    }
    input, select {
      background: #313244;
      color: #cdd6f4;
      border: 1px solid #45475a;
      padding: 8px;
      border-radius: 4px;
      margin: 5px;
    }
    #output {
      background: #11111b;
      color: #a6e3a1;
      padding: 15px;
      border-radius: 4px;
      height: 400px;
      overflow-y: auto;
      font-size: 12px;
      white-space: pre-wrap;
      font-family: 'Monaco', 'Menlo', monospace;
    }
    #status {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-weight: bold;
    }
    .connected {
      background: #a6e3a1;
      color: #1e1e2e;
    }
    .disconnected {
      background: #f38ba8;
      color: #1e1e2e;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #89b4fa;
      padding-left: 10px;
    }
    .log-error {
      border-left-color: #f38ba8;
      color: #f38ba8;
    }
    .log-success {
      border-left-color: #a6e3a1;
      color: #a6e3a1;
    }
  </style>
</head>
<body>
  <h1>ðŸ”Œ Tmux WebSocket Test Client</h1>

  <div id="status" class="disconnected">Disconnected</div>

  <div class="container">
    <div class="panel">
      <h2>Connection</h2>
      <input type="text" id="wsUrl" value="ws://localhost:3001" style="width: 100%;">
      <button id="connectBtn" onclick="connect()">Connect</button>
      <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
    </div>

    <div class="panel">
      <h2>Session Management</h2>
      <input type="text" id="sessionName" placeholder="Session name">
      <button onclick="listSessions()">List Sessions</button>
      <button onclick="createSession()">Create Session</button>
      <button onclick="killSession()">Kill Session</button>
    </div>

    <div class="panel">
      <h2>Command Execution</h2>
      <input type="text" id="execSession" placeholder="Session name">
      <input type="text" id="command" placeholder="Command">
      <button onclick="execCommand()">Execute</button>
      <button onclick="captureOutput()">Get Output</button>
    </div>

    <div class="panel">
      <h2>Streaming</h2>
      <input type="text" id="streamSession" placeholder="Session name">
      <button onclick="subscribe()">Subscribe</button>
      <button onclick="unsubscribe()">Unsubscribe</button>
      <button onclick="sendCtrlC()">Send Ctrl+C</button>
    </div>
  </div>

  <div class="panel" style="margin-top: 20px;">
    <h2>Output Log</h2>
    <button onclick="clearLog()">Clear Log</button>
    <div id="output"></div>
  </div>

  <script>
    let ws = null;
    let clientId = null;

    function log(message, type = 'info') {
      const output = document.getElementById('output');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      output.appendChild(entry);
      output.scrollTop = output.scrollHeight;
    }

    function updateStatus(connected) {
      const status = document.getElementById('status');
      status.textContent = connected ? 'Connected âœ“' : 'Disconnected âœ—';
      status.className = connected ? 'connected' : 'disconnected';

      document.getElementById('connectBtn').disabled = connected;
      document.getElementById('disconnectBtn').disabled = !connected;
    }

    function connect() {
      const url = document.getElementById('wsUrl').value;

      try {
        ws = new WebSocket(url);

        ws.onopen = () => {
          log('WebSocket connected', 'success');
          updateStatus(true);
        };

        ws.onmessage = (event) => {
          const data = JSON.parse(event.data);

          if (data.type === 'connected') {
            clientId = data.clientId;
            log(`Client ID: ${clientId}`, 'success');
          } else if (data.type === 'output') {
            log(`[${data.session}] Output received`, 'info');
            log(data.data, 'success');
          } else if (data.type === 'error') {
            log(`Error: ${data.error}`, 'error');
          } else {
            log(JSON.stringify(data, null, 2), 'info');
          }
        };

        ws.onclose = () => {
          log('WebSocket disconnected', 'error');
          updateStatus(false);
          ws = null;
        };

        ws.onerror = (error) => {
          log(`WebSocket error: ${error}`, 'error');
        };
      } catch (error) {
        log(`Connection error: ${error.message}`, 'error');
      }
    }

    function disconnect() {
      if (ws) {
        ws.close();
      }
    }

    function send(data) {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        log('Not connected!', 'error');
        return;
      }
      ws.send(JSON.stringify(data));
      log(`Sent: ${data.action}`, 'info');
    }

    function listSessions() {
      send({ action: 'list' });
    }

    function createSession() {
      const session = document.getElementById('sessionName').value;
      if (!session) {
        log('Please enter session name', 'error');
        return;
      }
      send({ action: 'create', session });
    }

    function killSession() {
      const session = document.getElementById('sessionName').value;
      if (!session) {
        log('Please enter session name', 'error');
        return;
      }
      send({ action: 'kill', session });
    }

    function execCommand() {
      const session = document.getElementById('execSession').value;
      const command = document.getElementById('command').value;
      if (!session || !command) {
        log('Please enter session and command', 'error');
        return;
      }
      send({ action: 'exec', session, command });
    }

    function captureOutput() {
      const session = document.getElementById('execSession').value;
      if (!session) {
        log('Please enter session name', 'error');
        return;
      }
      send({ action: 'capture', session, lines: 50 });
    }

    function subscribe() {
      const session = document.getElementById('streamSession').value;
      if (!session) {
        log('Please enter session name', 'error');
        return;
      }
      send({ action: 'subscribe', session });
    }

    function unsubscribe() {
      send({ action: 'unsubscribe' });
    }

    function sendCtrlC() {
      const session = document.getElementById('streamSession').value;
      if (!session) {
        log('Please enter session name', 'error');
        return;
      }
      send({ action: 'sendKeys', session, keys: 'C-c' });
    }

    function clearLog() {
      document.getElementById('output').innerHTML = '';
    }
  </script>
</body>
</html>
